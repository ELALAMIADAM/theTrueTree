<div class="tree-wrapper">
  <!-- Header -->
  <div class="tree-header">
    <h1 class="tree-title">
      <span class="title-english">Islamic Prophets Tree</span>
      <span class="title-arabic">ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿ£ŸÜÿ®Ÿäÿßÿ°</span>
    </h1>
  </div>

  <!-- SVG Tree Visualization -->
  <div class="tree-canvas-wrapper">
    <svg 
      class="tree-canvas" 
      [attr.width]="width" 
      [attr.height]="height"
      [attr.viewBox]="'0 0 ' + width + ' ' + height">
      
      <!-- Defs for gradients and patterns -->
      <defs>
        <linearGradient id="linkGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:#3498DB;stop-opacity:0.3" />
          <stop offset="100%" style="stop-color:#2ECC71;stop-opacity:0.3" />
        </linearGradient>
        
        <filter id="glow">
          <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
        
        <pattern id="islamicPattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
          <path d="M0,10 L10,0 L20,10 L10,20 Z" fill="none" stroke="#e0e0e0" stroke-width="0.5" opacity="0.3"/>
        </pattern>
      </defs>

      <!-- Background pattern -->
      <rect width="100%" height="100%" fill="url(#islamicPattern)"/>
      
      <!-- Tree Trunk -->
      <path 
        [attr.d]="getTrunkPath()" 
        fill="#8B4513"
        stroke="#654321"
        stroke-width="2"
        class="tree-trunk">
      </path>
      
      <!-- Links between prophets (branches) -->
      <g class="links">
        <path 
          *ngFor="let link of treeLinks"
          [attr.d]="getLinkPath(link)"
          class="prophet-link"
          [class.highlighted]="hoveredProphet && (hoveredProphet.id === link.from.prophet.id || hoveredProphet.id === link.to.prophet.id)"
          stroke="url(#linkGradient)"
          stroke-width="2"
          fill="none"
          opacity="0.6">
        </path>
      </g>
      
      <!-- Prophet nodes -->
      <g class="nodes">
        <g 
          *ngFor="let node of treeNodes"
          class="prophet-node"
          [class.hovered]="hoveredProphet?.id === node.prophet.id"
          [class.selected]="selectedProphet?.id === node.prophet.id"
          (mouseenter)="onProphetHover($event, node.prophet)"
          (mouseleave)="onProphetLeave()"
          (click)="onProphetClick(node.prophet)"
          style="cursor: pointer;">
          
          <!-- Special design for Adam (Father of Humanity) -->
          <g *ngIf="node.prophet.id === 1">
            <!-- Large outer circle (earth/ground) -->
            <circle [attr.cx]="node.x" [attr.cy]="node.y" [attr.r]="55" 
                    fill="#8B4513" stroke="#654321" stroke-width="4" opacity="0.6"/>
            <!-- Middle circle -->
            <circle [attr.cx]="node.x" [attr.cy]="node.y" [attr.r]="48" 
                    fill="#A0522D" stroke="#654321" stroke-width="3" opacity="0.8"/>
            <!-- Decorative ring -->
            <circle [attr.cx]="node.x" [attr.cy]="node.y" [attr.r]="42" 
                    fill="none" stroke="#FFD700" stroke-width="2" stroke-dasharray="5,3"/>
          </g>
          
          <!-- Special design for Abraham (Father of Prophets) - id: 6 -->
          <g *ngIf="node.prophet.id === 6">
            <!-- Outer star points -->
            <path [attr.d]="getStarPath(node.x, node.y, 50, 25, 8)" 
                  fill="#9370DB" stroke="#6A5ACD" stroke-width="3" opacity="0.8"/>
            <!-- Inner glow circle -->
            <circle [attr.cx]="node.x" [attr.cy]="node.y" [attr.r]="42" 
                    fill="#BA55D3" stroke="#9370DB" stroke-width="2" opacity="0.9"/>
          </g>
          
          <!-- Special design for Noah (Ark Builder) - id: 3 -->
          <g *ngIf="node.prophet.id === 3">
            <!-- Water waves -->
            <path [attr.d]="'M ' + (node.x - 45) + ' ' + (node.y + 20) + ' Q ' + (node.x - 30) + ' ' + (node.y + 10) + ' ' + (node.x - 15) + ' ' + (node.y + 20) + ' T ' + (node.x + 15) + ' ' + (node.y + 20) + ' T ' + (node.x + 45) + ' ' + (node.y + 20)" 
                  fill="none" stroke="#4682B4" stroke-width="3" opacity="0.8"/>
            <path [attr.d]="'M ' + (node.x - 45) + ' ' + (node.y + 30) + ' Q ' + (node.x - 30) + ' ' + (node.y + 20) + ' ' + (node.x - 15) + ' ' + (node.y + 30) + ' T ' + (node.x + 15) + ' ' + (node.y + 30) + ' T ' + (node.x + 45) + ' ' + (node.y + 30)" 
                  fill="none" stroke="#5F9EA0" stroke-width="3" opacity="0.7"/>
            <!-- Boat shape -->
            <ellipse [attr.cx]="node.x" [attr.cy]="node.y - 10" [attr.rx]="45" [attr.ry]="35" 
                     fill="#4169E1" stroke="#1E90FF" stroke-width="3" opacity="0.9"/>
          </g>
          
          <!-- Special design for Moses (Torah) - id: 15 -->
          <g *ngIf="node.prophet.id === 15">
            <!-- Tablets shape (two rectangles) -->
            <rect [attr.x]="node.x - 45" [attr.y]="node.y - 30" width="35" height="50" 
                  fill="#DAA520" stroke="#B8860B" stroke-width="3" rx="5" opacity="0.9"/>
            <rect [attr.x]="node.x + 10" [attr.y]="node.y - 30" width="35" height="50" 
                  fill="#DAA520" stroke="#B8860B" stroke-width="3" rx="5" opacity="0.9"/>
            <!-- Lines representing commandments -->
            <line [attr.x1]="node.x - 35" [attr.y1]="node.y - 20" [attr.x2]="node.x - 15" [attr.y2]="node.y - 20" 
                  stroke="#8B4513" stroke-width="2"/>
            <line [attr.x1]="node.x - 35" [attr.y1]="node.y - 10" [attr.x2]="node.x - 15" [attr.y2]="node.y - 10" 
                  stroke="#8B4513" stroke-width="2"/>
            <line [attr.x1]="node.x + 20" [attr.y1]="node.y - 20" [attr.x2]="node.x + 40" [attr.y2]="node.y - 20" 
                  stroke="#8B4513" stroke-width="2"/>
            <line [attr.x1]="node.x + 20" [attr.y1]="node.y - 10" [attr.x2]="node.x + 40" [attr.y2]="node.y - 10" 
                  stroke="#8B4513" stroke-width="2"/>
          </g>
          
          <!-- Special design for Jesus (Cross & Light) - id: 24 -->
          <g *ngIf="node.prophet.id === 24">
            <!-- Radiant light rays -->
            <line *ngFor="let angle of [0, 45, 90, 135, 180, 225, 270, 315]"
                  [attr.x1]="node.x + Math.cos(angle * Math.PI / 180) * 35"
                  [attr.y1]="node.y + Math.sin(angle * Math.PI / 180) * 35"
                  [attr.x2]="node.x + Math.cos(angle * Math.PI / 180) * 50"
                  [attr.y2]="node.y + Math.sin(angle * Math.PI / 180) * 50"
                  stroke="#87CEEB"
                  stroke-width="3"
                  stroke-linecap="round"
                  opacity="0.8">
            </line>
            <!-- Cross -->
            <rect [attr.x]="node.x - 3" [attr.y]="node.y - 25" width="6" height="50" 
                  fill="#CD853F" stroke="#8B4513" stroke-width="2" rx="2"/>
            <rect [attr.x]="node.x - 20" [attr.y]="node.y - 3" width="40" height="6" 
                  fill="#CD853F" stroke="#8B4513" stroke-width="2" rx="2"/>
          </g>
          
          <!-- Flower petals (for regular prophets) -->
          <g *ngIf="node.prophet.id !== 25 && node.prophet.id !== 1 && node.prophet.id !== 6 && node.prophet.id !== 3 && node.prophet.id !== 15 && node.prophet.id !== 24">
            <!-- Petal 1 (top) -->
            <ellipse [attr.cx]="node.x" [attr.cy]="node.y - 25" [attr.rx]="12" [attr.ry]="18" 
                     fill="#FFB6C1" stroke="#FF69B4" stroke-width="2" opacity="0.9"/>
            <!-- Petal 2 (top-right) -->
            <ellipse [attr.cx]="node.x + 22" [attr.cy]="node.y - 12" [attr.rx]="12" [attr.ry]="18" 
                     fill="#FFB6C1" stroke="#FF69B4" stroke-width="2" opacity="0.9" 
                     [attr.transform]="'rotate(72 ' + node.x + ' ' + node.y + ')'"/>
            <!-- Petal 3 (bottom-right) -->
            <ellipse [attr.cx]="node.x + 14" [attr.cy]="node.y + 20" [attr.rx]="12" [attr.ry]="18" 
                     fill="#FFB6C1" stroke="#FF69B4" stroke-width="2" opacity="0.9" 
                     [attr.transform]="'rotate(144 ' + node.x + ' ' + node.y + ')'"/>
            <!-- Petal 4 (bottom-left) -->
            <ellipse [attr.cx]="node.x - 14" [attr.cy]="node.y + 20" [attr.rx]="12" [attr.ry]="18" 
                     fill="#FFB6C1" stroke="#FF69B4" stroke-width="2" opacity="0.9" 
                     [attr.transform]="'rotate(216 ' + node.x + ' ' + node.y + ')'"/>
            <!-- Petal 5 (top-left) -->
            <ellipse [attr.cx]="node.x - 22" [attr.cy]="node.y - 12" [attr.rx]="12" [attr.ry]="18" 
                     fill="#FFB6C1" stroke="#FF69B4" stroke-width="2" opacity="0.9" 
                     [attr.transform]="'rotate(288 ' + node.x + ' ' + node.y + ')'"/>
          </g>
          
          <!-- Center circle for regular prophets (flowers) -->
          <circle 
            *ngIf="node.prophet.id !== 1 && node.prophet.id !== 6 && node.prophet.id !== 3 && node.prophet.id !== 15 && node.prophet.id !== 24 && node.prophet.id !== 25"
            [attr.cx]="node.x" 
            [attr.cy]="node.y" 
            [attr.r]="NODE_RADIUS"
            fill="#FFA500"
            stroke="#FF1493"
            stroke-width="3"
            class="node-circle">
          </circle>
          
          <!-- Adam's center circle -->
          <circle 
            *ngIf="node.prophet.id === 1"
            [attr.cx]="node.x" 
            [attr.cy]="node.y" 
            [attr.r]="NODE_RADIUS"
            fill="#D2691E"
            stroke="#8B4513"
            stroke-width="4"
            class="node-circle adam-node">
          </circle>
          
          <!-- Abraham's center circle -->
          <circle 
            *ngIf="node.prophet.id === 6"
            [attr.cx]="node.x" 
            [attr.cy]="node.y" 
            [attr.r]="NODE_RADIUS"
            fill="#DDA0DD"
            stroke="#9370DB"
            stroke-width="4"
            class="node-circle abraham-node">
          </circle>
          
          <!-- Noah's center circle -->
          <circle 
            *ngIf="node.prophet.id === 3"
            [attr.cx]="node.x" 
            [attr.cy]="node.y" 
            [attr.r]="NODE_RADIUS"
            fill="#87CEEB"
            stroke="#4169E1"
            stroke-width="4"
            class="node-circle noah-node">
          </circle>
          
          <!-- Moses' center circle -->
          <circle 
            *ngIf="node.prophet.id === 15"
            [attr.cx]="node.x" 
            [attr.cy]="node.y" 
            [attr.r]="NODE_RADIUS"
            fill="#F0E68C"
            stroke="#DAA520"
            stroke-width="4"
            class="node-circle moses-node">
          </circle>
          
          <!-- Jesus' center circle -->
          <circle 
            *ngIf="node.prophet.id === 24"
            [attr.cx]="node.x" 
            [attr.cy]="node.y" 
            [attr.r]="NODE_RADIUS"
            fill="#E6E6FA"
            stroke="#87CEEB"
            stroke-width="4"
            class="node-circle jesus-node">
          </circle>
          
          <!-- Muhammad's center circle -->
          <circle 
            *ngIf="node.prophet.id === 25"
            [attr.cx]="node.x" 
            [attr.cy]="node.y" 
            [attr.r]="NODE_RADIUS + 5"
            fill="#FFD700"
            stroke="#FF8C00"
            stroke-width="5"
            class="node-circle muhammad-node">
          </circle>
          
          <!-- Enhanced design for Muhammad Ô∑∫ (The Sun) -->
          <g *ngIf="node.prophet.id === 25" class="muhammad-design">
            <!-- Outer sun rays (long) -->
            <g class="sun-rays-outer">
              <line *ngFor="let angle of [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330]"
                    [attr.x1]="node.x + Math.cos(angle * Math.PI / 180) * 55"
                    [attr.y1]="node.y + Math.sin(angle * Math.PI / 180) * 55"
                    [attr.x2]="node.x + Math.cos(angle * Math.PI / 180) * 85"
                    [attr.y2]="node.y + Math.sin(angle * Math.PI / 180) * 85"
                    stroke="#FFD700"
                    stroke-width="5"
                    stroke-linecap="round"
                    opacity="0.9">
              </line>
            </g>
            <!-- Inner sun rays (short) -->
            <g class="sun-rays-inner">
              <line *ngFor="let angle of [15, 45, 75, 105, 135, 165, 195, 225, 255, 285, 315, 345]"
                    [attr.x1]="node.x + Math.cos(angle * Math.PI / 180) * 50"
                    [attr.y1]="node.y + Math.sin(angle * Math.PI / 180) * 50"
                    [attr.x2]="node.x + Math.cos(angle * Math.PI / 180) * 65"
                    [attr.y2]="node.y + Math.sin(angle * Math.PI / 180) * 65"
                    stroke="#FFA500"
                    stroke-width="4"
                    stroke-linecap="round"
                    opacity="0.8">
              </line>
            </g>
            <!-- Outer glow circle -->
            <circle [attr.cx]="node.x" [attr.cy]="node.y" [attr.r]="48" 
                    fill="#FFD700" opacity="0.3"/>
            <!-- Middle circle -->
            <circle [attr.cx]="node.x" [attr.cy]="node.y" [attr.r]="42" 
                    fill="#FFA500" stroke="#FF8C00" stroke-width="3" opacity="0.9"/>
          </g>
          
          <!-- Prophet name in center of circle -->
          <text 
            [attr.x]="node.x" 
            [attr.y]="node.y + 5"
            text-anchor="middle"
            class="node-name"
            fill="#000000"
            font-size="12"
            font-weight="700">
            {{ getProphetName(node.prophet) }}
          </text>
          
          <!-- Special marker for Muhammad Ô∑∫ below name -->
          <text 
            *ngIf="node.prophet.id === 25"
            [attr.x]="node.x" 
            [attr.y]="node.y + 50"
            text-anchor="middle"
            class="prophet-symbol"
            fill="#8B4513"
            font-size="18"
            font-weight="bold">
            Ô∑∫
          </text>
        </g>
      </g>
    </svg>
  </div>

  <!-- Removed hover card - nodes stay stable on hover -->

  <!-- Detailed Modal -->
  <div *ngIf="showModal && selectedProphet" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="modal-close" (click)="closeModal()">&times;</button>
      
      <div class="modal-header">
        <h2 class="modal-title">
          {{ selectedProphet.name }}
          <span class="modal-arabic">{{ selectedProphet.arabicName }}</span>
        </h2>
        <div class="modal-meta">
          <span class="meta-item" *ngIf="selectedProphet.era">
            <strong>Era:</strong> {{ selectedProphet.era }}
          </span>
          <span class="meta-item" *ngIf="selectedProphet.lifeSpan">
            <strong>Life:</strong> {{ selectedProphet.lifeSpan }}
          </span>
          <span class="meta-item" *ngIf="selectedProphet.locationSent">
            <strong>Location:</strong> {{ selectedProphet.locationSent }}
          </span>
        </div>
      </div>

      <div class="modal-body">
        <!-- Description -->
        <section class="modal-section">
          <h3 class="section-title">
            <span class="icon">üìñ</span> Description
          </h3>
          <p class="description-text">{{ selectedProphet.description }}</p>
        </section>

        <!-- Scripture -->
        <section class="modal-section" *ngIf="selectedProphet.scripture">
          <h3 class="section-title">
            <span class="icon">üìú</span> Scripture
          </h3>
          <p class="scripture-text">{{ selectedProphet.scripture }}</p>
        </section>

        <!-- Major Events -->
        <section class="modal-section" *ngIf="selectedProphet.majorEvents && selectedProphet.majorEvents.length > 0">
          <h3 class="section-title">
            <span class="icon">‚≠ê</span> Major Events
          </h3>
          <ul class="events-list">
            <li *ngFor="let event of selectedProphet.majorEvents">{{ event }}</li>
          </ul>
        </section>

        <!-- Miracles -->
        <section class="modal-section" *ngIf="selectedProphet.miracles && selectedProphet.miracles.length > 0">
          <h3 class="section-title">
            <span class="icon">‚ú®</span> Miracles
          </h3>
          <ul class="miracles-list">
            <li *ngFor="let miracle of selectedProphet.miracles">{{ miracle }}</li>
          </ul>
        </section>

        <!-- Quranic References -->
        <section class="modal-section" *ngIf="(selectedProphet.resources?.quranRefs?.length ?? 0) > 0">
          <h3 class="section-title">
            <span class="icon">üìó</span> Quranic References
          </h3>
          <div class="quran-refs">
            <a *ngFor="let ref of selectedProphet.resources?.quranRefs!" 
               [href]="getQuranLink(ref)" 
               target="_blank"
               class="quran-ref quran-link">
              {{ ref }}
              <span class="external-link-icon">üîó</span>
            </a>
          </div>
        </section>

        <!-- Video Resources -->
        <section class="modal-section" *ngIf="(selectedProphet.resources?.videos?.length ?? 0) > 0">
          <h3 class="section-title">
            <span class="icon">üé•</span> Learn More (Videos)
          </h3>
          <div class="resources-list">
            <a 
              *ngFor="let video of selectedProphet.resources?.videos!" 
              [href]="video.url" 
              target="_blank"
              class="resource-link video-link">
              <span class="resource-icon">‚ñ∂Ô∏è</span>
              <div class="resource-info">
                <div class="resource-title">{{ video.title }}</div>
                <div class="resource-creator" *ngIf="video.creator">{{ video.creator }}</div>
              </div>
            </a>
          </div>
        </section>

        <!-- Book Resources -->
        <section class="modal-section" *ngIf="(selectedProphet.resources?.books?.length ?? 0) > 0">
          <h3 class="section-title">
            <span class="icon">üìö</span> Recommended Books
          </h3>
          <div class="books-list">
            <div *ngFor="let book of selectedProphet.resources?.books!" class="book-item">
              <div class="book-title">{{ book.title }}</div>
              <div class="book-author" *ngIf="book.author">by {{ book.author }}</div>
              <div class="book-description" *ngIf="book.description">{{ book.description }}</div>
            </div>
          </div>
        </section>
  </div>

      <div class="modal-footer">
        <button class="btn-youtube" (click)="openYouTube(selectedProphet)">
          üé• Search on YouTube
        </button>
        <button class="btn-close-modal" (click)="closeModal()">
          Close
        </button>
    </div>
    </div>
  </div>
</div>
